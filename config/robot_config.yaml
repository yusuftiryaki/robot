# OBA Robot - Ana KonfigÃ¼rasyon DosyasÄ± (Modern YapÄ±)
# Bu dosya, projenin temel ve varsayÄ±lan ayarlarÄ±nÄ± iÃ§erir.
# raspberry_pi.yaml yapÄ±sÄ± temel alÄ±narak yeniden dÃ¼zenlenmiÅŸtir.
# Ortama Ã¶zel ayarlar, 'environments' klasÃ¶rÃ¼ndeki dosyalarla ezilir.

# =====================================
# âš™ï¸ TEMEL AYARLAR
# =====================================
robot:
  name: "OBA SimÃ¼lasyon"
  version: "1.0.0"

simulation:
  enabled: true # VarsayÄ±lan olarak simÃ¼lasyon aktif
  real_time_factor: 1.0

# =====================================
# ğŸš— MOTOR KONTROLÃœ
# =====================================
motors:
  type: "simulation" # 'simulation' veya 'hardware'
  driver: "l298n" # VarsayÄ±lan sÃ¼rÃ¼cÃ¼ tipi

  # L298N #1 - Tekerlek MotorlarÄ± (Hareket)
  wheels:
    left:
      # L298N #1 Motor A
      pin_a: 7 # IN1
      pin_b: 8 # IN2
      pwm_pin: 18 # ENA (PWM)
      enable_pin: 9 # Enable
      encoder_pin_a: 2 # Encoder A
      encoder_pin_b: 3 # Encoder B
    right:
      # L298N #1 Motor B
      pin_a: 10 # IN3
      pin_b: 11 # IN4
      pwm_pin: 19 # ENB (PWM)
      enable_pin: 13 # Enable
      encoder_pin_a: 4 # Encoder A
      encoder_pin_b: 5 # Encoder B

  # L298N #2 - Yan FÄ±rÃ§a MotorlarÄ±
  brushes:
    side_right:
      # L298N #2 Motor A
      pin_a: 22 # IN1
      pin_b: 23 # IN2
      pwm_pin: 24 # ENA (PWM)
      enable_pin: 25 # Enable
    side_left:
      # L298N #2 Motor B
      pin_a: 20 # IN3
      pin_b: 21 # IN4
      pwm_pin: 26 # ENB (PWM)
      enable_pin: 16 # Enable
    main:
      # L298N #3 Motor A (Ana fÄ±rÃ§a)
      pin_a: 5 # IN1
      pin_b: 6 # IN2
      pwm_pin: 12 # ENA (PWM)
      enable_pin: 17 # Enable

  # Fan Motoru (L298N #3 Motor B)
  fan:
    pin_a: 27 # IN3
    pin_b: 28 # IN4
    pwm_pin: 13 # ENB (PWM)
    enable_pin: 1 # Enable

# =====================================
# ğŸ“¡ SENSÃ–RLER
# =====================================
sensors:
  simulation_mode: true # SimÃ¼lasyonda sensÃ¶rler sahte veri Ã¼retir

  # I2C sensÃ¶rleri
  i2c:
    bus: 1 # Raspberry Pi'daki varsayÄ±lan I2C bus'Ä±
    frequency: 100000
    devices:
      - type: "mpu6050"
        address: 0x68
        name: "main_imu"
        enabled: true
        update_rate: 100
        calibration_samples: 100
      - type: "ina219"
        address: 0x40
        name: "battery_monitor"
        enabled: true
        shunt_ohms: 0.1
        max_expected_amps: 10.0
        min_voltage: 10.5
        max_voltage: 12.6
        description: "Ana batarya seviye takibi"
      - type: "ina219"
        address: 0x41
        name: "charging_monitor"
        enabled: true
        shunt_ohms: 0.1
        max_expected_amps: 3.0
        description: "Åarj istasyonu baÄŸlantÄ± kontrolÃ¼"

  # GPIO tabanlÄ± sensÃ¶rler (butonlar, tamponlar vb.)
  gpio:
    mode: "BCM"
    warnings: false
    devices:
      - type: "button"
        pin: 15 # Emergency stop
        name: "acil_durma"
        enabled: true
        pull_up: true
      - type: "button"
        pin: 14 # Front bumper
        name: "tampon"
        enabled: true
        pull_up: true

  # UART tabanlÄ± sensÃ¶rler (GPS vb.)
  uart:
    - type: "gps"
      device: "/dev/serial0" # Pi'deki varsayÄ±lan UART portu
      baud_rate: 9600
      name: "gps_module"
      enabled: true
      update_rate: 1

  # Encoder sensÃ¶rleri (GPIO'da tanÄ±mlandÄ± ama buraya da referans)
  enkoder:
    enabled: true
    type: "rotary_encoder"
    left_pin_a: 2 # wheels.left.encoder_pin_a ile aynÄ±
    left_pin_b: 3 # wheels.left.encoder_pin_b ile aynÄ±
    right_pin_a: 4 # wheels.right.encoder_pin_a ile aynÄ±
    right_pin_b: 5 # wheels.right.encoder_pin_b ile aynÄ±
    pulse_per_revolution: 1000

# =====================================
# ğŸ“· KAMERA
# =====================================
camera:
  enabled: true
  type: "simulation" # 'simulation' veya 'hardware'
  device: "/dev/video0" # Linux kamera aygÄ±tÄ±
  width: 640
  height: 480
  fps: 30

  # SimÃ¼lasyon parametreleri - Engel tespit iÃ§in optimize
  simulation_params:
    test_pattern: true
    noise_level: 0.01 # Ã‡ok dÃ¼ÅŸÃ¼k noise - algoritmalarÄ± tetiklemesin

# =====================================
# ğŸ§­ NAVÄ°GASYON & LOKALÄ°ZASYON
# =====================================
navigation:
  enabled: true

  # ğŸš— Robot Fiziksel Parametreleri
  wheel_diameter: 0.065 # Tekerlek Ã§apÄ± (metre) - 6.5cm
  wheel_base: 0.235 # Tekerlek arasÄ± mesafe (metre) - 23.5cm

  # ğŸ§® Kalman Filtre AyarlarÄ±
  kalman:
    process_noise: 0.1 # Ä°ÅŸlem gÃ¼rÃ¼ltÃ¼sÃ¼
    measurement_noise: 0.5 # Ã–lÃ§Ã¼m gÃ¼rÃ¼ltÃ¼sÃ¼

  # ğŸ—ºï¸ Rota Planlama AyarlarÄ±
  path_planning:
    grid_resolution: 0.5 # Grid Ã§Ã¶zÃ¼nÃ¼rlÃ¼ÄŸÃ¼ (metre)
    obstacle_padding: 0.2 # Engel etrafÄ±nda gÃ¼venlik mesafesi (metre)

  # ğŸ¯ GÃ¶rev AyarlarÄ±
  missions:
    mowing:
      overlap: 0.1 # Åeritler arasÄ± Ã¶rtÃ¼ÅŸme mesafesi (metre)
      speed: 0.3 # BiÃ§me hÄ±zÄ± (m/s)
      brush_width: 0.25 # FÄ±rÃ§a geniÅŸliÄŸi (metre)

  # ğŸ”§ AkÄ±llÄ± Aksesuar YÃ¶netimi
  aksesuarlar:
    # Karar verme parametreleri
    min_bicme_hizi: 0.1 # Minimum biÃ§me hÄ±zÄ± (m/s)
    max_yan_firca_hizi: 0.3 # Maksimum yan fÄ±rÃ§a hÄ±zÄ± (m/s)
    kritik_batarya: 20 # Kritik batarya seviyesi (%)
    dusuk_batarya: 40 # DÃ¼ÅŸÃ¼k batarya seviyesi (%)
    guvenli_engel_mesafesi: 0.2 # GÃ¼venli engel mesafesi (metre)
    sinir_guvenlik_mesafesi: 1.0 # SÄ±nÄ±r gÃ¼venlik mesafesi (metre)

    # VarsayÄ±lan politika
    default_policy: "performans" # performans, tasarruf, sessiz, guvenlik

    # Politika ayarlarÄ±
    policies:
      performans:
        description: "Maksimum temizlik performansÄ±"
        fan_always_on: true
        aggressive_brushing: true
      tasarruf:
        description: "Enerji tasarrufu odaklÄ±"
        fan_minimal_use: true
        conservative_brushing: true
      sessiz:
        description: "GÃ¼rÃ¼ltÃ¼ minimizasyonu"
        fan_disabled: true
        quiet_operation: true
      guvenlik:
        description: "GÃ¼venlik odaklÄ± konservatif yaklaÅŸÄ±m"
        safety_first: true
        reduced_speed_limit: 0.2

  # ğŸ¡ BahÃ§e SÄ±nÄ±r Kontrol AyarlarÄ± (18.000 mÂ² = 150m x 120m)
  boundary_coordinates:
    - latitude: 41.008000
      longitude: 28.978000
    - latitude: 41.009080
      longitude: 28.978000
    - latitude: 41.009080
      longitude: 28.980015
    - latitude: 41.008000
      longitude: 28.980015

  boundary_safety:
    buffer_distance: 1.0 # GÃ¼venlik buffer mesafesi (metre)
    warning_distance: 2.0 # UyarÄ± mesafesi (metre)
    max_deviation: 0.5 # Maksimum sapma toleransÄ± (metre)
    check_frequency: 10 # Kontrol sÄ±klÄ±ÄŸÄ± (saniye)

# =====================================
# ğŸ”‹ ÅARJ SÄ°STEMÄ°
# =====================================
charging:
  enabled: true

  # ğŸŒ GPS Åarj Ä°stasyonu AyarlarÄ±
  gps_dock:
    latitude: 41.008150
    longitude: 28.978550
    accuracy_radius: 3.0

    # ğŸ¯ YaklaÅŸÄ±m Mesafe EÅŸikleri
    precise_approach_distance: 0.5
    medium_distance_threshold: 10.0
    apriltag_detection_range: 0.5

    # âš¡ YaklaÅŸÄ±m HÄ±zlarÄ±
    approach_speeds:
      normal: 0.3
      slow: 0.2
      very_slow: 0.1
      ultra_slow: 0.05
      precise: 0.02

  # ğŸ·ï¸ AprilTag Åarj Ä°stasyonu Parametreleri
  apriltag:
    enabled: true
    sarj_istasyonu_tag_id: 0
    tag_boyutu: 0.08

    # ğŸ“· Kamera Kalibrasyonu
    kamera_matrix:
      - [640.0, 0.0, 320.0]
      - [0.0, 640.0, 240.0]
      - [0.0, 0.0, 1.0]

    distortion_coeffs: [0.0, 0.0, 0.0, 0.0, 0.0]

    # ğŸ¯ Tespit Parametreleri
    detection:
      min_confidence: 0.5
      max_detection_distance: 2.0
      min_marker_perimeter_rate: 0.03
      max_marker_perimeter_rate: 4.0

    # ğŸ›ï¸ YaklaÅŸÄ±m ToleranslarÄ±
    tolerances:
      hedef_mesafe: 0.25
      hassas_mesafe: 0.08
      aci_toleransi: 5.0
      pozisyon_toleransi: 0.02

    # âš¡ HÄ±z AyarlarÄ±
    speeds:
      yaklasim_hizi: 0.1
      hassas_hiz: 0.02
      donme_hizi: 0.2

  # ğŸ”Œ INA219 GÃ¼Ã§ SensÃ¶rÃ¼ (charging_monitor ile uyumlu)
  power_sensor:
    enabled: true
    i2c_address: 0x41 # charging_monitor ile aynÄ±
    shunt_ohms: 0.1
    sarj_akimi_esigi: 0.1
    baglanti_voltaj_esigi: 11.0
    description: "INA219 gÃ¼Ã§ sensÃ¶rÃ¼, ÅŸarj istasyonu baÄŸlantÄ± kontrolÃ¼"

  # Geriye uyumluluk
  station_apriltag_id: 0
  voltage_threshold: 11.0

# =====================================
# ğŸŒ WEB ARAYÃœZÃœ
# =====================================
web_interface:
  enabled: true
  host: "0.0.0.0"
  port: 5000
  cors_enabled: true

# =====================================
# ğŸ“Š LOGLAMA
# =====================================
logging:
  level: "INFO"
  console:
    enabled: true
    colored: true
  file:
    enabled: true
    path: "logs/robot.log"
    max_size: 10 # MB
    backup_count: 5

# =====================================
# ğŸ“ VERÄ° YOLLARI
# =====================================
paths:
  data: "data"
  logs: "logs"
  models: "models"
  config: "config"
  temp: "temp"

# =====================================
# âš¡ PERFORMANS
# =====================================
performance:
  loop_frequency: 50 # Hz (development iÃ§in)
  max_linear_speed: 0.5 # m/s
  max_angular_speed: 1.0 # rad/s

# =====================================
# ğŸ›¡ï¸ GÃœVENLÄ°K
# =====================================
safety:
  enabled: true

  # ğŸš¨ ACÄ°L DURUM YÃ–NETÄ°MÄ°
  emergency_management:
    enabled: true
    auto_recovery: false
    emergency_stop_button:
      enabled: true
      require_manual_reset: true

  # ğŸ“ EÄÄ°M KONTROLÃœ
  tilt_control:
    enabled: true
    max_tilt_angle: 30
    warning_threshold: 0.7
    rapid_change_threshold: 10

  # ğŸ”‹ BATARYA GÃœVENLÄ°ÄÄ°
  battery_safety:
    enabled: true
    min_battery_voltage: 10.0
    rapid_drain_threshold: 5.0
    max_current_draw: 5.0

  # â° WATCHDOG KONTROLÃœ
  watchdog:
    enabled: true
    timeout: 10.0

  # ğŸ›¡ï¸ Ã‡ARPIÅMA TESPÄ°TÄ°
  collision_detection:
    enabled: true
    distance_threshold: 0.20 # 20 cm (simÃ¼lasyon iÃ§in)

  # ğŸ“Š LOGLAMA
  logging:
    log_all_events: true
    log_level: "INFO"

# =====================================
# ğŸ¯ DÄ°NAMÄ°K ENGEL KAÃ‡INMA (YENÄ°!)
# =====================================
dynamic_obstacle_avoidance:
  enabled: true

  # ğŸ¯ Dynamic Window Approach (DWA) Parametreleri
  dwa:
    velocity_resolution: 0.05 # 5cm/s hÄ±z adÄ±mlarÄ±
    angular_resolution: 0.1 # 0.1 rad aÃ§Ä±sal adÄ±mlar
    time_horizon: 2.0 # 2 saniye Ã¶ngÃ¶rÃ¼
    dt: 0.1 # 100ms zaman adÄ±mÄ±

    # ğŸ† Skor AÄŸÄ±rlÄ±klarÄ±
    weights:
      heading: 1.0 # Hedefe yÃ¶nelim
      obstacle: 2.0 # Engelden kaÃ§Ä±nma
      velocity: 0.5 # HÄ±z tercihi
      smoothness: 0.3 # YumuÅŸak hareket

  # ğŸ¤– Robot Fiziksel Parametreleri
  robot_physics:
    radius: 0.3 # 30cm robot yarÄ±Ã§apÄ±
    max_linear_speed: 0.5 # m/s
    max_angular_speed: 1.0 # rad/s
    max_linear_accel: 0.5 # m/sÂ²
    max_angular_accel: 1.0 # rad/sÂ²

  # ğŸ›¡ï¸ GÃ¼venlik Parametreleri
  safety:
    safety_distance: 0.5 # 50cm gÃ¼venlik mesafesi
    lookahead_distance: 2.0 # 2m Ã¶ngÃ¶rÃ¼ mesafesi
    emergency_brake_distance: 0.8 # 80cm acil fren mesafesi
    obstacle_timeout: 5.0 # 5s engel timeout

  # ğŸ” Engel Tespit Sistemi (Kamera OdaklÄ±)
  obstacle_detection:
    # ï¿½ Kamera TabanlÄ± Tespit (Ana Sistem)
    camera:
      enabled: true
      fov: 60 # 60Â° gÃ¶rÃ¼ÅŸ aÃ§Ä±sÄ±
      range: 4.0 # 4m menzil (ultrasonik olmadÄ±ÄŸÄ± iÃ§in artÄ±rÄ±ldÄ±)
      height: 0.2 # 20cm kamera yÃ¼ksekliÄŸi
      min_object_size: 0.05 # 5cm minimum engel boyutu (daha hassas)
      max_object_size: 3.0 # 3m maksimum engel boyutu (artÄ±rÄ±ldÄ±)
      detection_threshold: 0.6 # %60 gÃ¼ven seviyesi (biraz dÃ¼ÅŸÃ¼rÃ¼ldÃ¼)

      # ğŸ¯ GeliÅŸmiÅŸ Computer Vision Parametreleri
      edge_detection:
        enabled: true
        canny_lower: 50 # Canny edge detection alt eÅŸik
        canny_upper: 150 # Canny edge detection Ã¼st eÅŸik
        blur_kernel: 5 # Gaussian blur kernel boyutu

      depth_estimation:
        enabled: true
        baseline: 0.1 # Mono kamera iÃ§in yaklaÅŸÄ±k baseline
        focal_length: 640.0 # Kamera focal length (piksel)

      object_tracking:
        enabled: true
        max_tracking_distance: 1.0 # 1m maksimum takip mesafesi
        tracking_history: 5 # 5 frame geÃ§miÅŸ

      # ğŸš¨ Acil Durum Tespiti
      emergency_detection:
        close_range_threshold: 0.5 # 50cm yakÄ±n mesafe acil durumu
        rapid_approach_speed: 0.3 # 30cm/s hÄ±zla yaklaÅŸan objeler

    # ğŸ”„ Kamera TabanlÄ± Ã‡oklu Tespit
    multi_detection:
      enabled: true
      confidence_boost: 0.2 # Ã‡oklu tespit gÃ¼ven artÄ±ÅŸÄ±
      temporal_filtering: true # Zaman bazlÄ± filtreleme
      spatial_clustering: true # Mekansal kÃ¼meleme

  # ğŸ›ï¸ Navigasyon ModlarÄ±
  navigation_modes:
    normal:
      speed_factor: 1.0 # Normal hÄ±z Ã§arpanÄ±
      safety_factor: 1.0 # Normal gÃ¼venlik

    conservative:
      speed_factor: 0.5 # YarÄ± hÄ±z
      safety_factor: 1.5 # %50 fazla gÃ¼venlik

    aggressive:
      speed_factor: 1.2 # %20 daha hÄ±zlÄ±
      safety_factor: 0.8 # %20 daha az gÃ¼venlik

    emergency:
      speed_factor: 0.0 # Dur
      safety_factor: 2.0 # Maksimum gÃ¼venlik

  # âš¡ Performans AyarlarÄ±
  performance:
    max_replanning_frequency: 2.0 # 2 Hz replanning
    stuck_detection_limit: 20 # 20 dÃ¶ngÃ¼ = ~10s
    waypoint_tolerance: 0.3 # 30cm waypoint toleransÄ±

  # ğŸ§ª Test ve Debug
  debug:
    enabled: false
    visualization: false
    log_trajectories: false
    save_debug_data: false
# =====================================
# ğŸ—ºï¸ NAVÄ°GASYON (GÃœNCELLENDÄ°)
# =====================================

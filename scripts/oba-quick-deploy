#!/bin/bash
# ğŸš€ OBA Quick Deploy - Basit Deployment Wrapper
# HacÄ± Abi'nin hÄ±zlÄ± kurulum aracÄ±!

# Script yolu
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DEPLOY_SCRIPT="$SCRIPT_DIR/oba-deploy"

# Renkler
readonly GREEN='\033[0;32m'
readonly YELLOW='\033[1;33m'
readonly CYAN='\033[0;36m'
readonly NC='\033[0m'

echo -e "${CYAN}"
echo "ğŸš€ OBA Robot - HÄ±zlÄ± Deployment"
echo "================================"
echo -e "${NC}"

# IP adresi al
echo -e "${YELLOW}Raspberry Pi IP adresini girin:${NC}"
read -r PI_IP

if [[ -z "$PI_IP" ]]; then
    echo "âŒ IP adresi gerekli!"
    exit 1
fi

# Åifre al (gizli)
echo -e "${YELLOW}SSH ÅŸifresini girin (boÅŸ bÄ±rakabilirsiniz SSH key varsa):${NC}"
read -rs PI_PASSWORD

echo ""

# KullanÄ±cÄ± al (varsayÄ±lan: pi)
echo -e "${YELLOW}SSH kullanÄ±cÄ±sÄ± (varsayÄ±lan: pi):${NC}"
read -r PI_USER
PI_USER=${PI_USER:-pi}

# Opsiyonel parametreler
echo -e "${YELLOW}Sistem gÃ¼ncellemesini atlamak istiyor musunuz? (y/N):${NC}"
read -r SKIP_UPDATE

echo -e "${YELLOW}Hardware testini atlamak istiyor musunuz? (y/N):${NC}"
read -r SKIP_HARDWARE

# Parametreleri hazÄ±rla
DEPLOY_ARGS="--ip $PI_IP --user $PI_USER"

if [[ -n "$PI_PASSWORD" ]]; then
    DEPLOY_ARGS="$DEPLOY_ARGS --password $PI_PASSWORD"
fi

if [[ "$SKIP_UPDATE" =~ ^[Yy]$ ]]; then
    DEPLOY_ARGS="$DEPLOY_ARGS --skip-system-update"
fi

if [[ "$SKIP_HARDWARE" =~ ^[Yy]$ ]]; then
    DEPLOY_ARGS="$DEPLOY_ARGS --skip-hardware-test"
fi

# Ã–zet gÃ¶ster
echo ""
echo -e "${CYAN}ğŸ“‹ DEPLOYMENT Ã–ZETÄ°${NC}"
echo "===================="
echo "ğŸ“ IP: $PI_IP"
echo "ğŸ‘¤ KullanÄ±cÄ±: $PI_USER"
echo "âš ï¸ GÃ¼ncellemeleri atla: ${SKIP_UPDATE:-N}"
echo "ğŸ”§ Hardware testini atla: ${SKIP_HARDWARE:-N}"
echo ""

echo -e "${YELLOW}Deployment baÅŸlatÄ±lsÄ±n mÄ±? (y/N):${NC}"
read -r CONFIRM

if [[ ! "$CONFIRM" =~ ^[Yy]$ ]]; then
    echo "âŒ Deployment iptal edildi"
    exit 0
fi

# Deployment'Ä± baÅŸlat
echo -e "${GREEN}ğŸš€ Deployment baÅŸlÄ±yor...${NC}"
echo ""

eval "$DEPLOY_SCRIPT $DEPLOY_ARGS"
